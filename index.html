<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
<title>操作系统</title>
<script type="text/javascript" src="js/jquery-3.1.1.slim.min.js"></script>
<link rel="stylesheet" href="css/bootstrap.min.css">
<link rel="stylesheet" href="css/index.css">

</head>

<body>
<div class="os">
<h1 class="alert alert-info">多级反馈队列</h1>
<div class="main">
<table border="0">
  <tr>
    <td   align="right" valign="top"><h3 class="alert alert-danger">队列1(2s)：</h3></td>
    <td><ul time="2"></ul></td>
  </tr>
  <tr>
    <td  align="right" valign="top"><h3 class="alert alert-danger">队列2(4s)：</h3></td>
    <td><ul time="4"></ul></td>
  </tr>
   <tr>
    <td  align="right" valign="top"><h3 class="alert alert-danger">队列3(8s)：</h3></td>
    <td><ul time="8"></ul></td>
  </tr>
   <tr>
    <td  align="right" valign="top"> <h3 class="alert alert-danger">队列4(16s)：</h3></td>
    <td><ul time="16"></ul></td>
  </tr>
</table>
</div>
<form>
<span class="alert alert-danger pname">进程名</span>&nbsp;&nbsp;&nbsp;<input type="text" name="name" id="name" />
<span class="alert alert-danger tname">进程时间</span>&nbsp;&nbsp;&nbsp;<input type="text" name="time" id="time"/>
</br>
<button type="button" class="btn btn-lg btn-primary"  id="add"/>添加进程</button>
<button type="button" class="btn btn-warning"  id="stop" disabled="disabled"/>中断进程</button>
<button type="button" class="btn btn-success" id="run"/>运行进程</button>
</form>
<span class="label label-default footerspan">
  <Strong>网络工程 三班 汪余佳</Strong>
  
</span>
</div>


<script type="text/javascript">
var queue;//队列长度
var pcb;//当前进程
var queueID;//当前级队列
var queuetime;//队列时间
var t;//当前进程时间
var timeid;//当前进程时间编号
queue=$(".os ul").length;
$("#add").click(
                function(){
                    var newname=$.trim($("#name").val());
                    var newtime=$.trim($("#time").val());
                    if(newname==""){alert("进程名不能为空!");return false;}
                    var timeREG=/^[0-9]+$/;
                    var retime=new RegExp(timeREG);
                    if(!retime.test(newtime)){alert("时间必须为数字");return false};
                    var newstr='<li time="'+newtime+'">'+newname+'(<span>'+newtime+'</span>s)</li>';
                    $(".os ul:first").prepend(newstr);
                });
$("#stop").click(
                 function(){
                     window.clearInterval(timeid);
                     $(this).attr({"disabled":"disabled"});
                     $("#run").removeAttr("disabled");
                     $("#add").removeAttr("disabled");
                     pcbSave();
                 }
                 );
$("#run").click(
                function(){
                    if( $(".os li").length>0 ){
                        findpcb();
                    }else{
                        return false;
                    }
                    $(this).attr({"disabled":"disabled"});
                    $("#add").attr({"disabled":"disabled"});
                    $("#stop").removeAttr("disabled");
                    timeid=window.setInterval("pcbRun()",1000);
                    }
                );
//找到需要执行的队列
function findpcb(){
    for(var i=0;i<queue;i++){
        var curentqueue=$(".os ul:eq("+i+")");
        var j=curentqueue.children().length;//当前队列中的进程数
        queuetime=curentqueue.attr("time");//当前队列执行时间片
        if( j>0 ){
            pcb=$(".os ul:eq("+i+") li:last");//当前进程
            t=pcb.attr("time");
            $(".curent").removeClass("curent");
            pcb.addClass("curent");
            queueID=i;
            break;
        }
    }
}
//进程执行
function pcbRun(){
    if(t>0 && queuetime>0){
        timeReduce();
    }else{
        if(t>0){
            pcb.removeClass();
            pcbSave();
            pcb.remove();
            if( queueID < (queue-1) ){
                $(".os ul:eq("+(queueID+1)+")").prepend(pcb);
            }else{
                $(".os ul:last").prepend(pcb);
            }
        }else{
            //时间片执行完
            pcb.remove();
        }
        findpcb();
    }
    var lilength=$(".os li").length;
    if(lilength==0){
        $("#stop").attr({"disabled":"disabled"});
        $("#run").removeAttr("disabled");
        $("#add").removeAttr("disabled");
         window.clearInterval(timeid);
    }
}
//进程保护
function pcbSave(){
    pcb.attr({"time":t});
}
//减小时间
function timeReduce(){
    t--;
    queuetime--;
    pcb.children().html(t);
}
</script>
</body>
</html>
